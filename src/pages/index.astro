---
import Layout from '../layouts/Layout.astro';
import { getClientData } from '../data/transactions';

const data = getClientData();
const jsonData = JSON.stringify(data);
---

<Layout title="Ledgr — Financial Dashboard">
  <div class="dashboard">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1>Ledgr</h1>
        <p class="subtitle">{data.stats.dateRange.from} — {data.stats.dateRange.to} · {data.stats.totalTransactions.toLocaleString()} transactions</p>
      </div>
      <div class="header-right">
        <button class="btn btn-upload" id="upload-btn" aria-label="Upload CSV">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 10V2m0 0L5 5m3-3 3 3M2 10v2a2 2 0 002 2h8a2 2 0 002-2v-2"/></svg>
          Upload CSV
        </button>
        <span class="badge badge-emerald">● Revolut</span>
        <span class="badge badge-sky">GBP</span>
      </div>
    </header>

    <!-- Tabs -->
    <nav class="tabs" role="tablist">
      <button class="tab active" data-target="tab-overview" role="tab">Overview</button>
      <button class="tab" data-target="tab-transactions" role="tab">Transactions</button>
      <button class="tab" data-target="tab-categories" role="tab">Categories</button>
      <button class="tab" data-target="tab-merchants" role="tab">Merchants</button>
      <button class="tab" data-target="tab-insights" role="tab">Insights</button>
    </nav>

    <!-- Tab Panels -->
    <div id="tab-overview" class="tab-panel active" role="tabpanel"></div>
    <div id="tab-transactions" class="tab-panel" role="tabpanel"></div>
    <div id="tab-categories" class="tab-panel" role="tabpanel"></div>
    <div id="tab-merchants" class="tab-panel" role="tabpanel"></div>
    <div id="tab-insights" class="tab-panel" role="tabpanel"></div>

    <!-- Footer -->
    <footer class="footer">
      <p>Dashboard generated from Revolut account statement · Data processed at build time · Not financial advice</p>
    </footer>
  </div>

  <!-- Upload Modal -->
  <div class="modal-overlay" id="upload-modal">
    <div class="modal">
      <div class="modal-header">
        <h3>Upload Statement</h3>
        <button class="modal-close" id="upload-close">&times;</button>
      </div>
      <div class="modal-body" id="upload-body">
        <!-- Drop zone (initial state) -->
        <div id="upload-dropzone" class="dropzone">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" stroke="var(--text-muted)" stroke-width="1.5">
            <path d="M24 32V8m0 0l-8 8m8-8 8 8"/>
            <path d="M8 28v8a4 4 0 004 4h24a4 4 0 004-4v-8"/>
          </svg>
          <p class="dropzone-text">Drop your Revolut CSV here</p>
          <p class="dropzone-sub">or <label class="dropzone-browse">browse<input type="file" accept=".csv" id="upload-file" hidden /></label></p>
        </div>
        <!-- Progress (shown after upload starts) -->
        <div id="upload-progress" class="upload-progress" style="display:none">
          <div class="progress-steps" id="progress-steps"></div>
          <div class="progress-status" id="progress-status"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Data -->
  <script type="application/json" id="app-data" set:html={jsonData}></script>

  <!-- App (bundled by Vite) -->
  <script>
    import '../scripts/app.ts';
  </script>
</Layout>
